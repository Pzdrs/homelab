---
apiVersion: apps/v1
kind: Deployment
metadata:
    name: homepage
    namespace: homepage 
    labels:
        app.kubernetes.io/name: homepage
spec:
    selector:
        matchLabels:
            app.kubernetes.io/name: homepage
    template:
        metadata:
            labels:
                app.kubernetes.io/name: homepage
        spec:
            serviceAccountName: homepage
            automountServiceAccountToken: true
            dnsPolicy: ClusterFirst
            containers:
              - name: homepage
                image: "ghcr.io/gethomepage/homepage:v1.4.3"
                imagePullPolicy: Always
                ports:
                  - name: http
                    containerPort: 3000
                    protocol: TCP
                env:
                  - name: HOMEPAGE_ALLOWED_HOSTS
                    value: "hub.pycrs.cz"
                resources:
                  requests:
                    cpu: 100m
                    memory: 128Mi
                  limits:
                    cpu: 200m
                    memory: 256Mi
                envFrom:
                  - secretRef:
                      name: jellyfin
                  - secretRef:
                      name: jellyseer 
                  - secretRef:
                      name: pve1 
                  - secretRef:
                      name: pbs1 
                  - secretRef:
                      name: portainer 
                  - secretRef:
                      name: qbit 
                  - secretRef:
                      name: scale 
                  - secretRef:
                      name: arr 
                  - secretRef:
                      name: grafana 
                  - secretRef:
                      name: pihole 
                  - secretRef:
                      name: home-assistant 
                  - secretRef:
                      name: unifi 
                  - secretRef:
                      name: authentik 
                  - secretRef:
                      name: speedtest-tracker
                  - secretRef:
                      name: immich 
                volumeMounts:
                  - mountPath: /app/config/custom.js
                    name: homepage-config
                    subPath: custom.js
                  - mountPath: /app/config/custom.css
                    name: homepage-config
                    subPath: custom.css
                  - mountPath: /app/config/bookmarks.yaml
                    name: homepage-config
                    subPath: bookmarks.yaml
                  - mountPath: /app/config/docker.yaml
                    name: homepage-config
                    subPath: docker.yaml
                  - mountPath: /app/config/kubernetes.yaml
                    name: homepage-config
                    subPath: kubernetes.yaml
                  - mountPath: /app/config/services.yaml
                    name: homepage-config
                    subPath: services.yaml
                  - mountPath: /app/config/settings.yaml
                    name: homepage-config
                    subPath: settings.yaml
                  - mountPath: /app/config/widgets.yaml
                    name: homepage-config
                    subPath: widgets.yaml
                  - mountPath: /app/config/logs
                    name: logs
            volumes:
                - name: homepage-config
                  configMap:
                      name: homepage
                - name: logs
                  emptyDir: {}